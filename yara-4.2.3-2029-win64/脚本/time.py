#!/usr/bin/env.python
# -*- coding: utf-8 -*-

import yara
import os
import time

# 扫描函数
def scan(rule, path):
    for filepath,dirnames,filenames in os.walk(path):
        for filename in filenames:
            mapath=os.path.join(filepath,filename)
            # print(mapath)
            try:
                fp = open(mapath, 'rb')
                matches = rule.match(data=fp.read())
                if len(matches) > 0:print(mapath)
            except:
                print(filename,"为系统文件不进行扫描")

if __name__ == '__main__':
    rulepath ="C:/Users/许健/Desktop/yara-4.2.3-2029-win64/my_first_rule.yar"   # yara规则目录
    malpath ="C:/Chapter_1L" # 扫描目录
    # yara规则编译函数调用
    yararule = yara.compile(rulepath)
    # 扫描函数调用
    t1=time.time()
    scan(yararule, malpath)
    t2=time.time()
    print("扫描时间： ",(t2-t1)," 秒")
